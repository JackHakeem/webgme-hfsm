# UML State Machine Software Generator Design

This document describes how the UML State Machine meta maps into
executable C++ code.

# States

States get generated into their own class definitions which are
instantiated once and which inherit from StateMachine::StateBase.  A
state is contained within the scope / namespace of its parent state.
A state has a reference to which of its children is the currently
active substate (if any exist) and a list of all its child substates.

## Special States

Certain special states exist; this section describes how these special
states are implemented.

### Initial States

Intial states are generated as a pointer to the correct child state in
a function of the parent state called `getInitial()`. This pointer is
constant since the initial state is known directly from the model.

### End States

Directly transition to the state defined by the model and if no state
exists, we must be in the final end state for the state machine and
should end the state machine.

NEED TO DETERMINE WHAT THE RIGHT WAY TO END THE STATE MACHINE IS

### Choice Pseudostates

Choice Pseudostates are generated as conditional blocks within the
originating transition code to directly check the ensuing guards for
the outbound transitions of the choice pseudostates and determine
which state to transition to directly. The end states are hardcoded
in.

### Deep History Pseudostates

Transitions to deep history substates are generated as transitions to
the parent containing the history substate and will call the parent
state's `setDeepHistory()`.

### Shallow History Pseudostates

Transitions to shallow history substates are generated as transitions
to the parent containing the history substate and will call the parent
state's `setShallowHistory()`.

# Events

Events can get generated by states in the machine or other code
running on the target system. These events will be propagated through
to the current active leaf state of the HFSM and then bubble their way
up to the root until they reach a state which has internal or external
transitions that handle that event at which point the event will be
consumed.

# Transitions

Transitions are generated as a sequence of conditionals on the Event
itself, followed by the conditionals of the guards on any of the
transitions that have that event.

## Internal Transitions

Internal transitions will be checked in the state before any external
transitions.

## External Transitions

External transitions are the last transitions of a state to be
checked; if the Event has not been handled by the external
transitions, then the event propagates to the parent state and
continues evaluation.
